# **CloudPayments модуль для Joomla - Hikashop**
Модуль позволит с легкостью добавить на ваш сайт оплату банковскими картами через платежный сервис CloudPayments. Для корректной работы модуля необходима регистрация в сервисе.

Порядок регистрации описан в документации CloudPayments

### Совместимость:
- Hikashop >= 3.4.0
- Joomla >= 3.8.2


Модуль тестировался на Hikashop = 3.4.0 (Joomla = 3.8.2)

### Возможности:
- Одностадийная схема оплаты;
- Двухстадийная схема оплаты;
- Отмена, подтверждение и возврат платежей из ЛК CMS;
- Поддержка онлайн-касс (ФЗ-54);
- Отправка чеков по email;
- Отправка чеков по SMS;



### Установка через панель управления
В панели адмниистратора зайти в раздел "Расширения/Менеджер расширений/Установка"
https://yadi.sk/i/rM90TBdP3ZkQ8F

После чего загружаем zip архив

### Настройка плагина
- Переходим в настройки Hikashop - https://yadi.sk/i/Jw_5QJ2Q3ZkQer
- Далее выбираем способы оплаты - https://yadi.sk/i/7bosq8vx3ZkQms
- Жмем кнопку "Создать" - https://yadi.sk/i/PFZUhXkJ3ZkQrm
- Выбираем наш платежный плагин - https://yadi.sk/i/jUwh4YQA3ZkR3c
- В качестве имени новой платежной системы указываем: "Cloudpayments" - **это обязательный пункт!!!** - https://yadi.sk/i/A9hInMmk3ZkRWw
- Также выбираем "Опубликовать" - "да"
- Далее вводим "Public ID" - из личного кабинета мерчанта cloudpayments и пароль API, указываем нужные статусы для реагирования плагина на изменения заказа. Для двухстадийки также надо добавить новый статус "авторизации".

После настройки плагина - сохраняем изменения и переходим к настройки вебхуков в ЛК мерчанта cloudpayments
Все подсказки по настройки есть в шапке плагина. 

### Настройка вебхуков
Заходим в ЛК мерчанта cloudpayments. Сайты -> Добавить сайт
https://yadi.sk/i/H__cxY1c3ZkRfm
Далее в списке сайтов выбираем наш сайт и заходим в настройки https://yadi.sk/i/8jmK0keA3ZkRpA
Далее активируем нужный пункт и добавляем адрес вебхука - https://yadi.sk/i/3pP4do1C3ZkRtE
Список нужных вебхуков:

Настройки Сheck уведомлений: http://ваш_домен/bitrix/tools/sale_ps_result.php?action=check
Настройки Pay уведомлений: http://ваш_домен/bitrix/tools/sale_ps_result.php?action=pay
Настройки Fail уведомлений: http://ваш_домен/bitrix/tools/sale_ps_result.php?action=fail
Настройки Void уведомлений: http://ваш_домен/bitrix/tools/sale_ps_result.php?action=void
Настройки Confirm уведомлений: http:/ваш_домен/bitrix/tools/sale_ps_result.php?action=confirm
Настройки Refund уведомлений: http://ваш_домен/bitrix/tools/sale_ps_result.php?action=refund
соответственно где **ваш_домен** нужно заменить на домен вашего сайта


**Внимание!!!** Убедитесь, что используемые валюты в глобальных настройках VirtueMart'а, а именно их трехбуквенные наименования совпадают с параметрами, поддерживающимися сервисом отправки чеков. https://cloudpayments.ru/Docs/Directory#currencies
Так же будьте внимательны с настройками НДС.






